{% extends 'base.html' %}
{%load static%}

{% block title %}
    <title>Halaman Control Detail Layanan</title>
{% endblock title %}
{% block app_css %}
<link rel="stylesheet" href="{% static 'control/css/styles.css' %}">
<link rel="stylesheet" href="{% static 'css/styles.css'%}">

{% endblock app_css %}




{% block navbar-text %}
    {{page_title}}
{% endblock navbar-text %}
{% block alt %}
<span class="monitor">
    {{nama_layanan}}
</span>
{% endblock alt %}

{% block row %}
<div class="row">
    <div class="col-sm">
        <div class="q-bar">
            {% if now == 'Habis' %}
                <h2 class="next-queue-label">Nomor Antrian Berikutnya </h2><span id = 'curr'>{{now}}</span>
            {%else%}
                <h2 class="next-queue-label">Nomor Antrian Berikutnya </h2><span id = 'curr'>{{layanan}}-{{now}}</span>
            {% endif %}
        </div>
       
        <div class="block_total">
            <h3 >Sisa Jumlah Antrian : <span id="sisa_antrian">{{total}}</span></h3>
        </div>
        


        <form action="{%url 'control:call'%}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="code_layanan" value="{{layanan}}">
            <input type="hidden" name='stat' value="open">
            {% if stat == 'closed' %}
                <input type="hidden" name="onCall" value="{{active}}">
                <input type="hidden" name='stat' value="closed">
                <a href="{%url 'control:finish' layanan active%}" class="btn btn-info">Finish</a>
                <a href="{%url 'control:control'%}" class="btn btn-info">Kembali</a>
                <a href="{%url 'control:skip' layanan active%}" type="btn" class="btn btn-warning">Skip</a>
               
            {% elif stat == 'open' %}
                <input type="hidden" name="total" value="{{total}}">
                <input type="hidden" name="onCall" value="{{now}}">
                <button type="submit" class="btn btn-info">Panggil</button>
                <a href="{%url 'control:skip' layanan active%}" type="btn" class="btn btn-warning">Skip</a>
            {% endif %}
            
        </form>
        
       
            
    </div>
    <div class="col-sm">
        <div class="q-bar">
            {% if active == 'NoServing' %}
                <h3 class="next-queue-label">Sedang Dilayani  </h3><span class="on-serve">{{active}}</span>
            {% else%}
                <h3 class="next-queue-label">Sedang Dilayani </h3><span class="on-serve">{{layanan}}-{{active}}</span>
            {% endif %}
        </div>
        
            
        
    </div>
</div>
<br>
<br>
<div class="row">
    <h3>Daftar Antrian yang Dilompati (Skip)</h3>
    
        <table class="table">
            <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Code Layanan</th>
                <th scope="col">No Antrian</th>
                <th scope="col">Action</th>
            </tr>
            </thead>
            {% if pending_stat == 'none' %}
            <tbody>
            <tr>
                <th scope="row"></th>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            </tbody>
            {%elif pending_stat == 'check'%}
            <tbody>
                {% for pending in pending_queue %}
                <tr>
                    <th scope="row">{{pending.no_antrian}}</th>
                    <td>{{pending.jenis_layanan}}</td>
                    <td>{{pending.jenis_layanan}}-{{pending.no_antrian}}</td>
                    <form action="{%url 'control:call'%}" method="POST">
                        <td>
                            {% csrf_token %}
                            <input type="hidden" name="code_layanan" value="{{layanan}}">
                            <input type="hidden" name='stat' value="{{stat}}">
                            <input type="hidden" name="onCall" value="{{pending.no_antrian}}">
                            <input type="hidden" name="total" value="{{total}}">
                            <button type="submit" class="btn btn-info">Panggil</button>
                        </td>
                    </form>
                    
                </tr>
                {% endfor %}
                </tbody>
        {% endif %}
        </table>     
</div>
<br><br>
{% endblock row %}
    
{% block javascripts %}
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script>
    $(document).ready(function(){
        setInterval(function(){
            $("#sisa_antrian").load(window.location.href + " #sisa_antrian" );
        }, 100);

        setInterval(function(){
            $("#curr").load(window.location.href + " #curr" );
        }, 100);
    });
</script>
{% endblock javascripts %}